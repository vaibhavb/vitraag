
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://fonts.googleapis.com/css?family=Lato:400,700" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Inconsolata:400,700" rel="stylesheet">
<link rel="stylesheet" href="https://www.vitraag.com//assets/css/mybulma.css">
<script defer src="https://use.fontawesome.com/releases/v5.6.0/js/all.js"></script>

    <title>Adding A HealthVault DataType to MoodTracker #4</title>
  </head>
<body>

<!---------------------------------------------------->  
<!--               Navbar Section                   -->  
<!---------------------------------------------------->  
<nav class="navbar is-link is-fixed-top" role="navigation" aria-label="main navigation">
  <div class="container is-fluid">
    <div class="navbar-brand">
        <!--
          <a class="navbar-item" href="https://www.vitraag.com/">
              <i class="fas fa-home fa-3x"></i>&nbsp;&nbsp;
              <title class="navbar-item" href="https://www.vitraag.com/">Vaibhav Bhandari</title>
          </a>
        -->
        <a class="navbar-burger" data-target="navMenu" role="button" aria-label="menu" aria-expanded="false">
            <span></span>
            <span></span>
            <span></span>
        </a>
    </div>
        <div class="navbar-menu" id="navMenu" >
          <div class="navbar-end">
            <a class="navbar-item" href="https://www.vitraag.com/#about">
              <span class="icon">
                <i class="fas fa-info"></i>
              </span>
              <span>About</span>
            </a>
            <a class="navbar-item" href="https://www.vitraag.com/#portfolio">
                <span class="icon">
                  <i class="fas fa-th-list"></i>
                </span>
                <span>Portfolio</span>
            </a>
            <div class="navbar-item has-dropdown is-hoverable">
              <a class="navbar-link">Blog</a>
              <div class="navbar-dropdown">
                <a href="/#blog" class="navbar-item">Posts By Category&nbsp;<span class="tag is-info">Blogs!</span></a>
                <a href="/posts-by-year" class="navbar-item">Posts By Year&nbsp;<span class="tag is-info">Blogs!</span></a>
              
                <a href="/projects-by-year" class="navbar-item">Projects By Year&nbsp;<span class="tag is-danger">New!</span></a>
                <a href="/travels" class="navbar-item">Travels By Year&nbsp;<span class="tag is-danger">New!</span></a>
              </div>
            </div>
            <div class="navbar-item has-dropdown is-hoverable">
              <a class="navbar-link">Pages</a>
              <div class="navbar-dropdown">
                <a href="https://www.vitraag.com/#ethics" class="navbar-item">       
                  <span class="icon">
                    <i class="fas fa-balance-scale"></i>
                  </span>
                  <span>Ethics&nbsp;</span>
                  <span class="tag is-primary">Life</span>
                </a>
                <a href="/kamal" class="navbar-item">2022 Moms Gratitude Ceremony&nbsp;<span class="tag is-primary">Family</span></a>
                <a href="/posts-by-year" class="navbar-item">Posts By Year&nbsp;<span class="tag is-info">Blogs!</span></a>
                <a href="/recipes" class="navbar-item">Family Recipes&nbsp;<span class="tag is-info">New!</span></a>
                <a href="https://vitraag.notion.site/Vaibhav-s-Public-Notion-Landing-Page-c24d42742ebc43d28ce2e22d41c3ba11" target="_blank" class="navbar-item">Notion &nbsp;<span class="tag is-info">Wiki</span></a>
                <a href="/notes/cats/" class="navbar-item">Second Brain&nbsp;<span class="tag is-info">Memory!</span></a>
                <a href="/test-todo-app/" class="navbar-item">Todo App</a>
                <a href="/me/" class="navbar-item">Me (Visual)</a>
              </div>
            </div>
            <div class="navbar-item has-dropdown is-hoverable">
              <a class="navbar-link">Projects</a>
              <div class="navbar-dropdown">
                <a href="https://www.cyberdefendersprogram.com" class="navbar-item" target="_blank">Cyber Defenders&nbsp;<span class="tag is-primary">Non-Profit</span></a>
                <a href="https://www.lib13.com" class="navbar-item" target="_blank">Lib13 &nbsp;<span class="tag is-primary">Inc</span></a>
                <a href="/digitalhealthconcierge" class="navbar-item">Digital Concierge&nbsp;<span class="tag is-info">Community!</span></a>
                <a href="/code/lira" class="navbar-item">Project Lira&nbsp;<span class="tag is-info">Code!</span></a>
                <a href="https://www.wisevoter.org" target="_blank" class="navbar-item">WiseVoter&nbsp;<span class="tag is-danger">Non-Profit!</span></a>
                <a href="/art" class="navbar-item">Art Work&nbsp;<span class="tag is-info">New!</span></a>
                <a href="/projects-by-year" class="navbar-item">Projects By Year&nbsp;<span class="tag is-danger">New!</span></a>
              </div>
            </div>
            <div class="navbar-item has-dropdown is-hoverable">
              <a class="navbar-link">
                  <span class="icon">
                    <i class="fa fa-archive"></i>
                  </span>
                  <span>Archive</span>
              </a>
              <div class="navbar-dropdown">
                <a href="https://legacy.vitraag.com" class="navbar-item" target="_blank">       
                  <span class="icon">
                    <i class="fa fa-world"></i>
                  </span>
                  <span>Old Website&nbsp;</span>
                  <span class="tag is-primary">2001</span>
                </a>
              </div>
            </div>

            <a class="navbar-item" href="https://www.vitraag.com/#resume">
              <span class="icon">
                <i class="fas fa-file-alt"></i>
              </span>
              <span>Resume</span>
            </a>
          </div>
        </div>
  </div>
</nav>



<!-- 2023-11-29: Disabling hero for now.
<section class="hero is-info is-medium is-bold">
  <div class="hero-body">
      <div class="container has-text-centered">
         <h1 class="title">Adding A HealthVault DataType to MoodTracker #4</h1> 
      </div>
  </div>
</section>
-->

<div class="container">
  <!-- START ARTICLE FEED -->
  <section class="articles">
      <div class="column is-8 is-offset-2">
          <!-- START ARTICLE -->
          <div class="card article">
              <div class="card-content">
                  <div class="media">
                      <div class="media-content has-text-centered">
                          <p class="title article-title">Adding A HealthVault DataType to MoodTracker #4</p>
                          <div class="tags has-addons level-item">
                              <span class="tag is-rounded is-info">Vaibhav Bhandari</span>
                              <span class="tag is-rounded">Sat Jun 25 05:58:52 2011</span>
                              <span class="tag is-rounded is-warning">Mobile, MoodTracker</span>
                          </div>
                      </div>
                  </div>
                  <div class="content article-body">
                    <p>Last time we figured out how to <a href="http://healthblog.vitraag.com/2011/06/associating-mood-tracker-with-healthvault-3/">associate our application with HealthVault</a>. In this post we will focus on reading data from HealthVault.</p>

<p>So the data type we settled on was EmotionalState, we can find a <a href="http://developer.healthvault.com/pages/types/viewsamplexml.aspx?name=Emotional%20State&amp;id=4b7971d6-e427-427d-bf2c-2fbcf76606b3">sample xml</a> for this type on the HealthVault Developer Center.</p>

<p>Out first goal is to be able to display this type in our application. We need test data for emotional state so we add test information to our developer account from <a href="http://developer.healthvault.com/pages/types/types.aspx">type samples</a>.</p>

<p><a href="/assets/images/2011/06/image3.png"><img src="/assets/images/2011/06/image_thumb3.png" alt="image" /></a></p>

<p>Fig 1. Adding Emotional State sample to HealthVault record.</p>

<p>Please note: You need to be signed in to developer.healthvault.com to add the above sample.</p>

<p>We can verify that this sample is added to our record by using the <a href="http://developer.healthvault.com/pages/view/things.aspx">HealthExplorer</a>.</p>

<p><a href="/assets/images/2011/06/image4.png"><img src="/assets/images/2011/06/image_thumb4.png" alt="image" /></a></p>

<p>Fig 2. Emotional State Samples in developer account.</p>

<p>The easiest way to get-things from HealthVault is using the GetThings version 3 method. A Get on things can be performed using various filters for the purposes of this application which just retrieve all the active things of type Emotional State.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                HealthVaultMethods.GetThings(EmotionalStateModel.TypeId, GetThingsCompleted);
</code></pre></div></div>

<p>To make it easier to work with GetThings I implemented a simple abstraction on the method in <a href="https://github.com/vaibhavb/moodtracker/blob/master/MoodTracker/HealthVaultMethods.cs">HealthVaultMethods</a> class.</p>

<p>Now once we can get thing emotional state things we need to perform two things on the client side.</p>

<ol>
  <li>Sort them in the date order and pick the latest one</li>
</ol>

<p>For this item Linq to XML comes in very handy, just in three lines we can make this query work!</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> &lt;span class="rem"&gt;// using linq to get the latest reading of emotional state&lt;/span&gt;
 XElement latestEmotion = (from thingNode &lt;span class="kwrd"&gt;in&lt;/span&gt; responseNode.Descendants(&lt;span class="str"&gt;"thing"&lt;/span&gt;)
         orderby Convert.ToDateTime(thingNode.Element(&lt;span class="str"&gt;"eff-date"&lt;/span&gt;).Value) descending
         select thingNode).FirstOrDefault&lt;XElement&gt;();
</code></pre></div></div>

<p>.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, “Courier New”, courier, monospace;
	background-color: #ffffff;
	/<em>white-space: pre;</em>/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }</p>

<ol>
  <li>Parse them for the mood, stress and wellbeing data.</li>
</ol>

<p>We can achieve this my creating a <a href="https://github.com/vaibhavb/moodtracker/blob/master/MoodTracker/EmotionalStateModel.cs">model</a> for Emotional State. Have a good model makes if super easy to parse the XElement to the object we need –</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> EmotionalStateModel emotionalState =
     &lt;span class="kwrd"&gt;new&lt;/span&gt; EmotionalStateModel();
     emotionalState.Parse(latestEmotion.Descendants(&lt;span class="str"&gt;"data-xml"&lt;/span&gt;).Descendants(&lt;span class="str"&gt;"emotion"&lt;/span&gt;).Single());
</code></pre></div></div>

<p>XElement and lazy evaluation makes our job super-simple, compared to XPathNavigator -</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;p&gt; &lt;span class="kwrd"&gt;public&lt;/span&gt; &lt;span class="kwrd"&gt;void&lt;/span&gt; Parse(XElement emotionalState)
 {
            
        &lt;span class="kwrd"&gt;this&lt;/span&gt;.Mood = (Mood) System.Enum.Parse(&lt;span class="kwrd"&gt;typeof&lt;/span&gt;(Mood),
           ((XElement)emotionalState.Element(&lt;span class="str"&gt;"mood"&lt;/span&gt;)).Value, &lt;span class="kwrd"&gt;true&lt;/span&gt;);
        &lt;span class="kwrd"&gt;this&lt;/span&gt;.Stress = (Stress) System.Enum.Parse(&lt;span class="kwrd"&gt;typeof&lt;/span&gt;(Stress),
            ((XElement)emotionalState.Element(&lt;span class="str"&gt;"stress"&lt;/span&gt;)).Value, &lt;span class="kwrd"&gt;true&lt;/span&gt;);
        &lt;span class="kwrd"&gt;this&lt;/span&gt;.Wellbeing = (Wellbeing) System.Enum.Parse(&lt;span class="kwrd"&gt;typeof&lt;/span&gt;(Wellbeing),
            ((XElement)emotionalState.Element(&lt;span class="str"&gt;"wellbeing"&lt;/span&gt;)).Value, &lt;span class="kwrd"&gt;true&lt;/span&gt;);
 }&lt;/p&gt;&lt;p&gt; &lt;/p&gt;&lt;p&gt;Now we are ready to show the latest emotional state reading!!&lt;/p&gt;&lt;p&gt; &lt;/p&gt;&lt;p&gt;&lt;a href="/assets/images/2011/06/image5.png"&gt;&lt;img src="/assets/images/2011/06/image_thumb5.png" style="padding-left:0;padding-right:0;padding-top:0;border-width:0;" title="image" height="332" width="199" alt="image" border="0"&gt;&lt;/img&gt;&lt;/a&gt;&lt;/p&gt;
</code></pre></div></div>

<p>Fig 3. Latest Emotional State Reading in Mood Tracker!</p>

<p>**Next Time: **We will look at how we can enter new data with Mood Tracker!</p>

                  </div>
              </div>
          </div>
      </div> 
</section>
<hr/>
<section>
<div class="container">
  <h3 class="title is-5">Related posts you may enjoy: </h3>
  <div class="columns">
  
  
  

 
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
        <div class="column is-onethird">
          <a href="/2011/07/02/graphing-for-windows-phone-7-mood-tracker-6/">
              <div class="rel">
                  <h5>Graphing for Windows Phone 7– Mood Tracker #6</h5>
              </div>
          </a>
        </div>
      
      
    
  

   
    
    

    

    
        <div class="column is-onethird">
          <a href="/2011/06/29/entering-new-data-with-mood-tracker-5/">
              <div class="rel">
                  <h5>Entering new data with Mood Tracker #5</h5>
              </div>
          </a>
        </div>
      
      
    
  

   
    
    

    

    
  

   
    
    

    

    
        <div class="column is-onethird">
          <a href="/2011/06/24/associating-mood-tracker-with-healthvault-3/">
              <div class="rel">
                  <h5>Associating Mood Tracker With HealthVault #3</h5>
              </div>
          </a>
        </div>
      
      
        
</div>
</div>
</section>


<hr/>
<footer class="footer">
    <div class="section-heading">
      <p>
        <a href="https://www.twitter.com/vaibhavb"><i class="fab fa-twitter-square fa-2x"></i></a> 
        <a href="https://www.github.com/vaibhavb"><i class="fab fa-github fa-2x"></i></a>
        <a href="https://www.linkedin.com/in/vaibhavb"><i class="fab fa-linkedin fa-2x"></i></a>
        <a href="http://legacy.vitraag.com/cse/index.html"><i class="fas fa-globe fa-2x"></i></a>
        <br/><strong>&copy; 2023 Vaibhav Bhandari</strong>
        <br/><span class="credit">Last Updated on Wed Aug 21 22:35:12 2024</span>
      </p>
    </div>
</footer>
<script async src="https://www.vitraag.com//assets/js/main.js"></script>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-MQQHR1JXTN"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-MQQHR1JXTN');
</script>
</body>
</html>
