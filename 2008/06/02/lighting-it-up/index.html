
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://fonts.googleapis.com/css?family=Lato:400,700" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Inconsolata:400,700" rel="stylesheet">
<link rel="stylesheet" href="https://www.vitraag.com//assets/css/mybulma.css">
<script defer src="https://use.fontawesome.com/releases/v5.6.0/js/all.js"></script>

    <title>Lighting it up!</title>
  </head>
<body>

<!---------------------------------------------------->  
<!--               Navbar Section                   -->  
<!---------------------------------------------------->  
<nav class="navbar is-link is-fixed-top" role="navigation" aria-label="main navigation">
  <div class="container is-fluid">
    <div class="navbar-brand">
        <!--
          <a class="navbar-item" href="https://www.vitraag.com/">
              <i class="fas fa-home fa-3x"></i>&nbsp;&nbsp;
              <title class="navbar-item" href="https://www.vitraag.com/">Vaibhav Bhandari</title>
          </a>
        -->
        <a class="navbar-burger" data-target="navMenu" role="button" aria-label="menu" aria-expanded="false">
            <span></span>
            <span></span>
            <span></span>
        </a>
    </div>
        <div class="navbar-menu" id="navMenu" >
          <div class="navbar-end">
            <a class="navbar-item" href="https://www.vitraag.com/#about">
              <span class="icon">
                <i class="fas fa-info"></i>
              </span>
              <span>About</span>
            </a>
            <a class="navbar-item" href="https://www.vitraag.com/#portfolio">
                <span class="icon">
                  <i class="fas fa-th-list"></i>
                </span>
                <span>Portfolio</span>
            </a>
            <div class="navbar-item has-dropdown is-hoverable">
              <a class="navbar-link">Blog</a>
              <div class="navbar-dropdown">
                <a href="/#blog" class="navbar-item">Posts By Category&nbsp;<span class="tag is-info">Blogs!</span></a>
                <a href="/posts-by-year" class="navbar-item">Posts By Year&nbsp;<span class="tag is-info">Blogs!</span></a>
              
                <a href="/projects-by-year" class="navbar-item">Projects By Year&nbsp;<span class="tag is-danger">New!</span></a>
                <a href="/travels" class="navbar-item">Travels By Year&nbsp;<span class="tag is-danger">New!</span></a>
              </div>
            </div>
            <div class="navbar-item has-dropdown is-hoverable">
              <a class="navbar-link">Pages</a>
              <div class="navbar-dropdown">
                <a href="https://www.vitraag.com/#ethics" class="navbar-item">       
                  <span class="icon">
                    <i class="fas fa-balance-scale"></i>
                  </span>
                  <span>Ethics&nbsp;</span>
                  <span class="tag is-primary">Life</span>
                </a>
                <a href="/kamal" class="navbar-item">2022 Moms Gratitude Ceremony&nbsp;<span class="tag is-primary">Family</span></a>
                <a href="/posts-by-year" class="navbar-item">Posts By Year&nbsp;<span class="tag is-info">Blogs!</span></a>
                <a href="/recipes" class="navbar-item">Family Recipes&nbsp;<span class="tag is-info">New!</span></a>
                <a href="https://vitraag.notion.site/Vaibhav-s-Public-Notion-Landing-Page-c24d42742ebc43d28ce2e22d41c3ba11" target="_blank" class="navbar-item">Notion &nbsp;<span class="tag is-info">Wiki</span></a>
                <a href="/notes/cats/" class="navbar-item">Second Brain&nbsp;<span class="tag is-info">Memory!</span></a>
                <a href="/test-todo-app/" class="navbar-item">Todo App</a>
                <a href="/me/" class="navbar-item">Me (Visual)</a>
              </div>
            </div>
            <div class="navbar-item has-dropdown is-hoverable">
              <a class="navbar-link">Projects</a>
              <div class="navbar-dropdown">
                <a href="https://www.cyberdefendersprogram.com" class="navbar-item" target="_blank">Cyber Defenders&nbsp;<span class="tag is-primary">Non-Profit</span></a>
                <a href="https://www.lib13.com" class="navbar-item" target="_blank">Lib13 &nbsp;<span class="tag is-primary">Inc</span></a>
                <a href="/digitalhealthconcierge" class="navbar-item">Digital Concierge&nbsp;<span class="tag is-info">Community!</span></a>
                <a href="/code/lira" class="navbar-item">Project Lira&nbsp;<span class="tag is-info">Code!</span></a>
                <a href="https://www.wisevoter.org" target="_blank" class="navbar-item">WiseVoter&nbsp;<span class="tag is-danger">Non-Profit!</span></a>
                <a href="/art" class="navbar-item">Art Work&nbsp;<span class="tag is-info">New!</span></a>
                <a href="/projects-by-year" class="navbar-item">Projects By Year&nbsp;<span class="tag is-danger">New!</span></a>
              </div>
            </div>
            <div class="navbar-item has-dropdown is-hoverable">
              <a class="navbar-link">
                  <span class="icon">
                    <i class="fa fa-archive"></i>
                  </span>
                  <span>Archive</span>
              </a>
              <div class="navbar-dropdown">
                <a href="https://legacy.vitraag.com" class="navbar-item" target="_blank">       
                  <span class="icon">
                    <i class="fa fa-world"></i>
                  </span>
                  <span>Old Website&nbsp;</span>
                  <span class="tag is-primary">2001</span>
                </a>
              </div>
            </div>

            <a class="navbar-item" href="https://www.vitraag.com/#resume">
              <span class="icon">
                <i class="fas fa-file-alt"></i>
              </span>
              <span>Resume</span>
            </a>
          </div>
        </div>
  </div>
</nav>



<!-- 2023-11-29: Disabling hero for now.
<section class="hero is-info is-medium is-bold">
  <div class="hero-body">
      <div class="container has-text-centered">
         <h1 class="title">Lighting it up!</h1> 
      </div>
  </div>
</section>
-->

<div class="container">
  <!-- START ARTICLE FEED -->
  <section class="articles">
      <div class="column is-8 is-offset-2">
          <!-- START ARTICLE -->
          <div class="card article">
              <div class="card-content">
                  <div class="media">
                      <div class="media-content has-text-centered">
                          <p class="title article-title">Lighting it up!</p>
                          <div class="tags has-addons level-item">
                              <span class="tag is-rounded is-info">Vaibhav Bhandari</span>
                              <span class="tag is-rounded">Mon Jun  2 10:24:19 2008</span>
                              <span class="tag is-rounded is-warning">HealthVault, Open Source, Python, RubyOnRails</span>
                          </div>
                      </div>
                  </div>
                  <div class="content article-body">
                    <p>Alrite now that you have the firewood (application auth token) and the firestarter (user auth token) how can we start the fire (get details user’s record).</p>

<p>Well first of all congratulations! most of the hard part is done!! Just a few more nitty gritty tricks though! In order to get the details about a user’s health record, you need to use a method <strong>GetPersonInfo</strong>.</p>

<p>The XML for GetPersonInfo look like this:</p>

<p>[code lang=html]</p>
<pre class="html">

  da9WYaQGEoseAYDOhJv2cwNIEVg=

</pre>
<header>GetPersonInfo 1 ASAAADNt1Jwbx85MgH9vkWzAINBxBWQFCtQ+osTzGw/I0Ty27OhKFCXUb83dxI5/M2mtGYymc1gKx6qwsWEtw31ZV/tyscJwmc5dNT2o2nYJcFTf1vfi/L4R5V68ckxFrd48Rz4jhU9Yg6lDhNTymCsJSDiVJCKLqKwcHcr/QSTsytRpVXBK7LpAVBicjC3OPGCEg4XE/UGwM7ZDAXlR4AR+emiHBaPOzSQD9iYMYxAyDBYZPde8N+rDv58zFw9pjDLJJIwvhXOOLahhFvX/n5DqwAb+BpdTlE19x5P/B67kKie/zDtEYWHEXHMhX+KNdvrxdm17l5pwt8JShIGimbXgAcZEFTiPVOW77mCgDxpc0U2ykcG7RVqXKTA3Gqt42OZf9aCuzq/J0wHOTLQvdx1ZYVOxo7+1TpMaW+13Fz5/jgOHR7hJZ/DPUIcKfCYdHS7phQ3r60nOReUl2qeq7rDvDmGQBWPjcCrT7CuQRSgZlyUpAav4DiFJtKh9U5DbJ5VW80dUAqcxamulklTxSR75Sb6v0X4T8B2zbfmVl+HtcupUIuz66Q== ASAAAE57vlXwS8VDupO6/FSWlMZR+OL02JQyhWvlesegc/J6f7XGgJq4xRW1WIWc7ZXufY9U1cAFeQMDF9pAvmNG1/1KGlp7FFFBdrUMk7gJLPpdTYkQeDMdp8UXcXNht+U6hJzpI7plchQKvpBMFeBj1XMOC15fLXRyfRFpD3RaIF66awgUVw== en US 2008-06-01T02:44:16.73Z 1800 0.9.1712.2902 1mWxpY+leClypXQzPvDBLFIBDpI=</header>
<p>[/code]</p>

<p>So now do we go about concoting the seemingly complicated xml above. Well we already have the token and wctoken from our previous CreateAuthenticatedSession and Shell -redirect. Use the token for the auth-token in line 9 and the wctoken as user-token in line 10.</p>

<p>Most of the elements in the header section are straight forward. The one to comment about is hash-data (line 18). The hash in this case is SHA-1 hash of the info section. Matter of fact our info section is empty so that make sure that the SHA-1 hash is done right. In ruby i do it the following way (using OpenSSL):</p>

<p>[code lang=ruby]
def self.doSha1(text)
    Base64.encode64(OpenSSL::Digest::SHA1.digest(text)).chomp
end
[/code]</p>

<p>Now the interesting part - whats this auth on line 2? Well auth is a HMAC of header (line 5-20) section. Remember we generated the shared secret in CreateAutheticatedSession method? Now use that secret to do a HMAC digest for the header. In ruby i do it the following way:</p>

<p>[code lang=ruby]
def self.doHmac(secret, payload)
    key = Base64.decode64(secret)
    hashmac = OpenSSL::HMAC.digest(OpenSSL::Digest::SHA1.new(key), key, payload)
    Base64.encode64(hashmac).chomp
  end
[/code]</p>

<p>secret is the shared secret used for createauthenticationtoken.</p>

<p>Now the fun part,caveats:</p>

<ul>
  <li>
    <p>Don’t leave any white spaces between you xml tags. HealthVault behaves weird sometime when their is white space.</p>
  </li>
  <li>
    <p>If you are getting an error saying code 3 (which implied invalid xml) and you are sure that your xml is correct, then most likely your auth section or your hash-data section are not proper. Which in turn implies that your HMAC-ing or SHA-1 hashing is a little off. The best way to actually resolve this is to first write tiny parts which make sure that the HMAC /SHA-1 is same for a known successfully call. You can get the xml for such a call from HealthVault SDK, the process is described <a href="http://healthblog.vitraag.com/2008/06/curious-about-whats-under-the-healthvault-sdks-hood/">here</a>. However for ease of testing i’m appending know good calls below.</p>
  </li>
</ul>

<p><strong>PLEASE NOTE</strong>: Remove all the white-space between tags before testing your crypto functions to match the result seen here. I have put the white space for readability.</p>

<p>CreateAuthenticatedSessionToken (for SharedSecret)</p>

<p>[code lang=html]</p>
<header>CreateAuthenticatedSessionToken 1 05a059c9-c309-46af-9b86-b06d42510550 en US 2008-06-01T02:44:16.21Z 1800 0.9.1712.2902</header>
<p>05a059c9-c309-46af-9b86-b06d42510550 b2uCbONZDGj8jDYhz3e5PcJfugPQTHOsOvpZ6kA9uG5XzQXV+EHtXtTDAbwHbFyNozC1uR7uZwgi44pfgw4NyQp8LO2PwI9E7pOx/Ho7+6siY41sjI5+frhq2fcj8iljpG8EK07WGDuf4JeFg5yc8IWjHHtUwabpdPVJWYLi18+Gk7AaFfCuM1iQwFbBSWWMyckCe3V48JaCZcNVcS/XuJJovFdsM9QnZ1CwrQaaBB/evf1u1YGM3fXpVeCjVWPXpHiu3WWVVsJ5aURtCzGvXJe9R7Gh10sYDSG6wC/CJvcBSJlRCpacA1qds2gcMCBwO+iDCPY3I15+FbM0E9D+Qw== 05a059c9-c309-46af-9b86-b06d42510550 RXziN4RDYIu89cu+cOp4POLhKUCSUb0sPsV9yaz8m6BfJxjpDNUBRUF5MU3OJMJ7DH0FPXg8HFuahbvSz1HxG1Q6MlahpHAmUkXNBJ0zcrKvcH3+NiS3qD26FkpLXsvzjNv/QSxwqRMpYnDhY11RkUkOvz2M2Ybg9H5aEe7RpfYCYwEAudpj05J2KEFMP2WO1Q6Kz8hjIhf2QdswgzvLueUQ2ajG8Al9DvpGWLKl4dGNqnY1/FUnJOZq/nPivTYHYOcH/qpC5euWIt7bU6hXRehAIC9IYTbHG32jLBoIxhM79Wtj2sRdn4j3SBk/QVqQNXyPrAgFIzmtR7CSaN393A==
[/code]</p>

<p>Successful GetPersonInfo using the above SharedSecret:</p>

<p>[code lang=html]
da9WYaQGEoseAYDOhJv2cwNIEVg=</p>
<header>GetPersonInfo 1 ASAAADNt1Jwbx85MgH9vkWzAINBxBWQFCtQ+osTzGw/I0Ty27OhKFCXUb83dxI5/M2mtGYymc1gKx6qwsWEtw31ZV/tyscJwmc5dNT2o2nYJcFTf1vfi/L4R5V68ckxFrd48Rz4jhU9Yg6lDhNTymCsJSDiVJCKLqKwcHcr/QSTsytRpVXBK7LpAVBicjC3OPGCEg4XE/UGwM7ZDAXlR4AR+emiHBaPOzSQD9iYMYxAyDBYZPde8N+rDv58zFw9pjDLJJIwvhXOOLahhFvX/n5DqwAb+BpdTlE19x5P/B67kKie/zDtEYWHEXHMhX+KNdvrxdm17l5pwt8JShIGimbXgAcZEFTiPVOW77mCgDxpc0U2ykcG7RVqXKTA3Gqt42OZf9aCuzq/J0wHOTLQvdx1ZYVOxo7+1TpMaW+13Fz5/jgOHR7hJZ/DPUIcKfCYdHS7phQ3r60nOReUl2qeq7rDvDmGQBWPjcCrT7CuQRSgZlyUpAav4DiFJtKh9U5DbJ5VW80dUAqcxamulklTxSR75Sb6v0X4T8B2zbfmVl+HtcupUIuz66Q== ASAAAE57vlXwS8VDupO6/FSWlMZR+OL02JQyhWvlesegc/J6f7XGgJq4xRW1WIWc7ZXufY9U1cAFeQMDF9pAvmNG1/1KGlp7FFFBdrUMk7gJLPpdTYkQeDMdp8UXcXNht+U6hJzpI7plchQKvpBMFeBj1XMOC15fLXRyfRFpD3RaIF66awgUVw== enUS2008-06-01T02:44:16.73Z 18000.9.1712.29021mWxpY+leClypXQzPvDBLFIBDpI=</header>
<p>[/code]</p>

<p>Sweet!!! you wanna check out th lighted application? Well its <a href="http://openhealthvault.vitraag.com">live…</a> (Please Note: it will prompt you yo sign in with HealthVault id, its still rough around edges and doesn’t deal with corner cases).</p>

<p>So lets see your LAMPR application lighted up soon..</p>

<p>Next time: <a href="http://healthblog.vitraag.com/2008/08/putthings-for-offline-access/">How to do offline access and use PutThings </a></p>

                  </div>
              </div>
          </div>
      </div> 
</section>
<hr/>
<section>
<div class="container">
  <h3 class="title is-5">Related posts you may enjoy: </h3>
  <div class="columns">
  
  
  

 
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
        <div class="column is-onethird">
          <a href="/2013/04/02/5-open-source-health-it-tools/">
              <div class="rel">
                  <h5>5 Open Source Health IT Tools</h5>
              </div>
          </a>
        </div>
      
      
    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
        <div class="column is-onethird">
          <a href="/2013/03/03/at-himss-2013/">
              <div class="rel">
                  <h5>At HIMSS 2013</h5>
              </div>
          </a>
        </div>
      
      
    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
  

   
    
    

    

    
        <div class="column is-onethird">
          <a href="/2012/06/20/enabling-programmable-self-with-healthvault-and-more/">
              <div class="rel">
                  <h5>Enabling Programmable Self with HealthVault and more..</h5>
              </div>
          </a>
        </div>
      
      
        
</div>
</div>
</section>


<hr/>
<footer class="footer">
    <div class="section-heading">
      <p>
        <a href="https://www.twitter.com/vaibhavb"><i class="fab fa-twitter-square fa-2x"></i></a> 
        <a href="https://www.github.com/vaibhavb"><i class="fab fa-github fa-2x"></i></a>
        <a href="https://www.linkedin.com/in/vaibhavb"><i class="fab fa-linkedin fa-2x"></i></a>
        <a href="http://legacy.vitraag.com/cse/index.html"><i class="fas fa-globe fa-2x"></i></a>
        <br/><strong>&copy; 2023 Vaibhav Bhandari</strong>
        <br/><span class="credit">Last Updated on Wed Aug 21 22:35:12 2024</span>
      </p>
    </div>
</footer>
<script async src="https://www.vitraag.com//assets/js/main.js"></script>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-MQQHR1JXTN"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-MQQHR1JXTN');
</script>
</body>
</html>
